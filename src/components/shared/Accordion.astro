<div class="accordion group relative rounded-md hover:bg-white/5 hover:backdrop-blur-sm">
    <button
        type="button"
        class="accordion__button w-full text-left"
        aria-expanded="false"
        aria-controls="accordion-content"
    >
        <slot name="header" />
    </button>

    <div
        id="accordion-content"
        class="accordion__content max-h-0 overflow-hidden transition-[max-height] duration-300 ease-in-out"
    >
        <div class="px-3 pb-2 sm:px-4">
            <slot name="content" />
        </div>
    </div>
</div>

<script>
    function accordionSetup() {
        const accordions = document.querySelectorAll(".accordion");

        accordions.forEach((accordion, index) => {
            const button = accordion.querySelector(
                ".accordion__button"
            ) as HTMLButtonElement | null;

            const content = accordion.querySelector(
                ".accordion__content"
            ) as HTMLElement | null;

            if (!button || !content) return;

            const buttonId = `accordion-button-${index}`;
            const contentId = `accordion-content-${index}`;

            button.id = buttonId;
            content.id = contentId;

            button.setAttribute("aria-controls", contentId);
            content.setAttribute("aria-labelledby", buttonId);

            button.addEventListener("click", () => {
                const isOpen = button.getAttribute("aria-expanded") === "true";

                button.setAttribute("aria-expanded", String(!isOpen));
                accordion.classList.toggle("active", !isOpen);

                content.style.maxHeight = !isOpen
                    ? `${content.scrollHeight}px`
                    : "0px";
            });
        });
    }

    accordionSetup();
    document.addEventListener("astro:after-swap", accordionSetup);
</script>
